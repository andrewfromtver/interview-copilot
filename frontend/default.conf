upstream copilot-backend {
    server copilot-backend-1:80;
    server copilot-backend-2:80;
    server copilot-backend-3:80;
    server copilot-backend-4:80;
    server copilot-backend-5:80;
    server copilot-backend-6:80;
    server copilot-backend-7:80;
    server copilot-backend-8:80;
    server copilot-backend-9:80;
    server copilot-backend-10:80;
    server copilot-backend-11:80;
    server copilot-backend-12:80;
    server copilot-backend-13:80;
    server copilot-backend-14:80;
    server copilot-backend-15:80;
    server copilot-backend-16:80;
    server copilot-backend-17:80;
    server copilot-backend-18:80;
    server copilot-backend-19:80;
    server copilot-backend-20:80;
}

server {
  listen 80 default_server;

  proxy_next_upstream error timeout http_502;

  location / {
    root /usr/share/nginx/html;
  }

  location /v1/chat/completions {
    proxy_pass http://copilot-backend;
    proxy_redirect  off;
  }
}